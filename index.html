<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>the-future.sh</title>
    
    <!-- Libraries and Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/typed.js@2.1.0/dist/typed.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" xintegrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoVBL5gI9kLmbG4dGzcSTjpTJpe1pQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <style>
        /* --- Global Styles --- */
        :root {
            --background-color: #0d1117;
            --text-color: #c9d1d9;
            --prompt-color: #58a6ff;
            --accent-color: #56d364;
            --error-color: #f85149;
            --font-family: 'Roboto Mono', 'SF Mono', 'Courier New', monospace;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: var(--font-family);
            font-size: 16px;
            line-height: 1.6;
        }

        #header-container {
            padding: 20px 20px 0 20px;
            box-sizing: border-box;
        }

        #terminal {
            padding: 20px;
            box-sizing: border-box;
            height: calc(100% - 40px);
            overflow-y: auto;
            cursor: text;
        }

        .line {
            white-space: pre-wrap;
            word-break: break-all;
            min-height: 1.6em;
        }

        .prompt {
            color: var(--prompt-color);
            margin-right: 0.5em;
        }
        
        .command-input-container {
            display: flex;
            flex-grow: 1;
        }

        .terminal-input {
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-color);
            font-family: inherit;
            font-size: inherit;
            caret-color: var(--accent-color);
            flex-grow: 1;
            padding: 0;
        }

        .log-fatal { color: var(--error-color); }
        .log-info { color: var(--prompt-color); }
        .log-ok { color: var(--accent-color); }
        .log-tip { color: #8b949e; }

        #share-container {
            display: none;
            padding: 15px;
            border: 1px solid #30363d;
            border-radius: 6px;
            background-color: #161b22;
            margin-bottom: 20px;
        }

        #share-container img {
            max-width: 100%;
            border-radius: 6px;
            border: 1px solid #30363d;
            margin-top: 10px;
        }

        .share-buttons {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .share-button {
            background-color: var(--accent-color);
            color: var(--background-color);
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            transition: opacity 0.2s;
        }
        .share-button:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div id="header-container"></div>
    
    <div id="terminal">
        <!-- JavaScript will populate content here -->
    </div>

    <script>
        // --- DOM Elements & Settings ---
        const headerContainer = document.getElementById('header-container');
        const terminal = document.getElementById('terminal');
        let currentInput = null;
        const commandHistory = [];
        let historyIndex = -1;
        let interactiveMode = false;
        let interactiveStep = null;
        let interactiveVision = '';
        let interactiveCommit = '';

        // [NEW] Define the error message lines as a constant for reuse
        const errorLines = [
            { text: '<span class="log-fatal">[FATAL]</span> Core components missing. Future cannot be initialized.'},
            { text: '        Required flags: --vision, --commit'},
            { text: '' },
            { text: 'USAGE:'},
            { text: '  ./boot_future.sh --vision "a world where..." --commit "what you will do now"'},
            { text: '' },
            { text: '<span class="log-tip"># Tip: A vision without a commit is just a dream.</span>'}
        ];

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            terminal.addEventListener('click', () => {
                if (currentInput) {
                    currentInput.focus();
                }
            });
            runIntroAnimation();
        });

        // --- Helper Functions ---
        function addLine(text) {
            const line = document.createElement('div');
            line.className = 'line';
            line.innerHTML = text;
            terminal.appendChild(line);
            scrollToBottom();
            return line;
        }

        function createInputLine() {
            const line = document.createElement('div');
            line.className = 'line command-input-container';
            line.innerHTML = `<span class="prompt">$</span><input type="text" class="terminal-input" autofocus>`;
            terminal.appendChild(line);
            
            currentInput = line.querySelector('.terminal-input');
            currentInput.focus();
            historyIndex = commandHistory.length;

            currentInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const command = currentInput.value.trim();
                    if (command) {
                        commandHistory.push(command);
                    }
                    const parent = currentInput.parentElement;
                    parent.innerHTML = `<span class="prompt">$</span><span>${escapeHtml(command)}</span>`;
                    currentInput.disabled = true;
                    currentInput = null;
                    processCommand(command, parent);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (historyIndex > 0) {
                        historyIndex--;
                        currentInput.value = commandHistory[historyIndex];
                        currentInput.setSelectionRange(currentInput.value.length, currentInput.value.length);
                    }
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (historyIndex < commandHistory.length - 1) {
                        historyIndex++;
                        currentInput.value = commandHistory[historyIndex];
                        currentInput.setSelectionRange(currentInput.value.length, currentInput.value.length);
                    } else {
                        historyIndex = commandHistory.length;
                        currentInput.value = '';
                    }
                }
            });
            scrollToBottom();
        }

        // --- Core Logic ---
        function processCommand(command, lineElement) {
            // Handle shell environment commands
            const parts = command.split(' ');
            const cmd = parts[0];
            
            // Handle shell commands
            if (cmd === 'ls') {
                addLine('boot_future.sh  README.md  vision.txt');
                createInputLine();
                return;
            } else if (cmd === 'cat') {
                if (parts[1] === 'README.md') {
                    addLine('# the-future.sh');
                    addLine('> A tiny CLI simulator to boot your future.');
                    addLine('');
                    addLine('Visit https://github.com/yourusername/the-future.sh for full documentation.');
                } else if (parts[1] === 'vision.txt') {
                    addLine('Your vision awaits. Use ./boot_future.sh to define it.');
                } else if (parts[1]) {
                    addLine(`cat: ${parts[1]}: No such file or directory`);
                } else {
                    addLine('cat: missing file operand');
                }
                createInputLine();
                return;
            } else if (cmd === 'clear') {
                terminal.innerHTML = '';
                createInputLine();
                return;
            } else if (cmd === 'pwd') {
                addLine('/home/future/commits');
                createInputLine();
                return;
            } else if (cmd === 'whoami') {
                addLine('builder');
                createInputLine();
                return;
            } else if (cmd === 'help') {
                addLine('Available commands:');
                addLine('  ./boot_future.sh --vision "<vision>" --commit "<action>"  - Boot your future');
                addLine('  ./boot_future.sh --interactive                            - Guided mode');
                addLine('  ./boot_future.sh --help                                   - Show help');
                addLine('  ls                                                        - List files');
                addLine('  cat <file>                                                - Display file contents');
                addLine('  clear                                                     - Clear terminal');
                addLine('  pwd                                                       - Print working directory');
                addLine('  whoami                                                    - Display current user');
                addLine('  help                                                      - Show this help message');
                createInputLine();
                return;
            }
            
            // Check for boot_future.sh commands
            const bootRegex = /^(?:\.\/)?(boot_future\.sh)(.*)$/;
            const bootMatch = command.match(bootRegex);
            
            if (bootMatch) {
                const args = bootMatch[2].trim();
                
                // Handle --interactive flag
                if (args === '--interactive') {
                    lineElement.classList.add('shareable-log');
                    startInteractiveMode();
                    return;
                }
                
                // Handle --help flag
                if (args === '--help') {
                    addLine('Usage: ./boot_future.sh --vision "<vision>" --commit "<action>"');
                    addLine('');
                    addLine('Boot your future by declaring your vision and committing to action.');
                    addLine('');
                    addLine('Options:');
                    addLine('  --vision "<text>"     Your vision for the future (required)');
                    addLine('  --commit "<text>"     Your first concrete action (required)');
                    addLine('  --interactive         Start guided mode for beginners');
                    addLine('  --help                Show this help message');
                    addLine('');
                    addLine('Examples:');
                    addLine('  ./boot_future.sh --vision "a world of clean energy" --commit "install solar panels"');
                    addLine('  ./boot_future.sh --interactive');
                    createInputLine();
                    return;
                }
                
                // Check for vision and commit flags
                const visionCommitRegex = /--vision\s+["']([^"']+)["']\s+--commit\s+["']([^"']+)["']/;
                const match = args.match(visionCommitRegex);
                
                if (match) {
                    lineElement.classList.add('shareable-log');
                    const vision = match[1];
                    const commit = match[2];
                    runSuccessSequence(vision, commit);
                } else if (args === '') {
                    // Handle bare ./boot_future.sh
                    lineElement.classList.add('shareable-log');
                    runErrorSequence(() => {
                        setTimeout(createInputLine, 200);
                    });
                } else {
                    // Invalid arguments
                    lineElement.classList.add('shareable-log');
                    runErrorSequence(() => {
                        setTimeout(createInputLine, 200);
                    });
                }
            } else {
                // Command not found
                if (command) {
                    addLine(`zsh: command not found: ${escapeHtml(command.split(' ')[0])}`);
                }
                createInputLine();
            }
        }

        // --- Animation Sequences ---
        // Interactive mode functions
        function startInteractiveMode() {
            interactiveMode = true;
            interactiveStep = 'intro';
            
            addLine('');
            addLine('<span class="log-info">[INTERACTIVE MODE]</span> Welcome to the guided future boot process!');
            addLine('');
            addLine('This mode will help you craft your vision and commitment step by step.');
            addLine('Let\'s start by understanding what you want to create.');
            addLine('');
            addLine('What is your vision for the future? (Type your answer and press Enter)');
            addLine('<span class="log-tip"># Example: "a world where everyone has access to education"</span>');
            addLine('');
            
            createInteractiveInput();
        }
        
        function createInteractiveInput() {
            const line = document.createElement('div');
            line.className = 'line command-input-container';
            line.innerHTML = `<span class="prompt">></span><input type="text" class="terminal-input" autofocus>`;
            terminal.appendChild(line);
            
            currentInput = line.querySelector('.terminal-input');
            currentInput.focus();
            
            currentInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const value = currentInput.value.trim();
                    if (!value) return;
                    
                    const parent = currentInput.parentElement;
                    parent.innerHTML = `<span class="prompt">></span><span>${escapeHtml(value)}</span>`;
                    currentInput.disabled = true;
                    currentInput = null;
                    
                    handleInteractiveInput(value);
                }
            });
            scrollToBottom();
        }
        
        function handleInteractiveInput(value) {
            if (interactiveStep === 'intro') {
                interactiveVision = value;
                interactiveStep = 'commit';
                
                addLine('');
                addLine(`<span class="log-ok">[ OK ]</span> Vision recorded: "${escapeHtml(value)}"`);
                addLine('');
                addLine('Now, what is the first concrete action you will take to make this vision real?');
                addLine('<span class="log-tip"># Example: "sign up for an online course today"</span>');
                addLine('');
                
                createInteractiveInput();
            } else if (interactiveStep === 'commit') {
                interactiveCommit = value;
                interactiveStep = 'confirm';
                
                addLine('');
                addLine(`<span class="log-ok">[ OK ]</span> First commit recorded: "${escapeHtml(value)}"`);
                addLine('');
                addLine('Here\'s the command that will boot your future:');
                addLine('');
                addLine(`<span class="log-info">$</span> ./boot_future.sh --vision "${escapeHtml(interactiveVision)}" --commit "${escapeHtml(interactiveCommit)}"`);
                addLine('');
                addLine('Ready to execute? Type "yes" to proceed or "no" to cancel.');
                addLine('');
                
                createInteractiveInput();
            } else if (interactiveStep === 'confirm') {
                if (value.toLowerCase() === 'yes' || value.toLowerCase() === 'y') {
                    interactiveMode = false;
                    addLine('');
                    addLine('Executing command...');
                    addLine('');
                    
                    // Mark the command line as shareable
                    const cmdLine = addLine(`$ ./boot_future.sh --vision "${escapeHtml(interactiveVision)}" --commit "${escapeHtml(interactiveCommit)}"`);
                    cmdLine.classList.add('shareable-log');
                    
                    runSuccessSequence(interactiveVision, interactiveCommit, true); // true indicates training mode
                } else {
                    interactiveMode = false;
                    addLine('');
                    addLine('Interactive mode cancelled. You can try again anytime.');
                    createInputLine();
                }
            }
        }
        
        // [NEW] A dedicated function to display the error message sequence
        function runErrorSequence(onComplete) {
            let delay = 0;
            errorLines.forEach((line, index) => {
                setTimeout(() => {
                    const lineElement = addLine(line.text);
                    lineElement.classList.add('shareable-log');
                    if (index === errorLines.length - 1 && onComplete) {
                        onComplete();
                    }
                }, delay);
                delay += 100;
            });
        }

        function runIntroAnimation() {
            commandHistory.push('./boot_future.sh');
            
            const firstLine = addLine('$ ./boot_future.sh');
            firstLine.classList.add('shareable-log');

            setTimeout(() => {
                runErrorSequence(() => {
                    setTimeout(createInputLine, 200);
                });
            }, 500);
        }

        function runSuccessSequence(vision, commit, isTrainingMode = false) {
            const successLines = [
                { text: 'Initializing future with new parameters...' },
                { text: `<span class="log-info">[INFO]</span> Vision locked: "${escapeHtml(vision)}"` },
                { text: `<span class="log-info">[INFO]</span> First commit registered: "${escapeHtml(commit)}"` },
                { text: `<span class="log-ok">[ OK ]</span> Boot sequence complete.` },
                { text: `` },
                { text: `Future process started successfully. (PID: ${new Date().getFullYear()}${(new Date().getMonth() + 1).toString().padStart(2, '0')}${(new Date().getDate()).toString().padStart(2, '0')})`},
                { text: `Daemonizing... Your future is now running in the background. Keep committing.` }
            ];

            let delay = 0;
            successLines.forEach((line, index) => {
                setTimeout(() => {
                    const lineElement = addLine(line.text);
                    lineElement.classList.add('shareable-log');

                    if (index === successLines.length - 1) {
                        setTimeout(() => generateShareableImage(vision, commit, isTrainingMode), 500);
                    }
                }, delay);
                delay += (line.text.length * 15) + 100;
            });
        }
        
        // --- Shareable Image Generation ---
        function generateShareableImage(vision, commit, isTrainingMode = false) {
            const generatingLine = addLine('Generating a shareable snapshot...');
            generatingLine.classList.add('shareable-log');

            setTimeout(() => {
                const snapshotContainer = document.createElement('div');
                snapshotContainer.style.position = 'absolute';
                snapshotContainer.style.left = '-9999px';
                snapshotContainer.style.display = 'inline-block';
                snapshotContainer.style.padding = '20px';
                snapshotContainer.style.boxSizing = 'border-box';
                snapshotContainer.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--background-color');
                snapshotContainer.style.fontFamily = getComputedStyle(document.documentElement).getPropertyValue('--font-family');
                snapshotContainer.style.fontSize = '16px';
                snapshotContainer.style.lineHeight = '1.6';
                snapshotContainer.style.color = getComputedStyle(document.documentElement).getPropertyValue('--text-color');

                const linesToShare = document.querySelectorAll('.shareable-log');
                linesToShare.forEach(line => {
                    snapshotContainer.appendChild(line.cloneNode(true));
                });

                document.body.appendChild(snapshotContainer);

                html2canvas(snapshotContainer, { logging: false, backgroundColor: null }).then(canvas => {
                    // Add training mode watermark if needed
                    if (isTrainingMode) {
                        const ctx = canvas.getContext('2d');
                        ctx.save();
                        ctx.font = 'bold 48px ' + getComputedStyle(document.documentElement).getPropertyValue('--font-family');
                        ctx.fillStyle = 'rgba(88, 166, 255, 0.3)';
                        ctx.textAlign = 'center';
                        ctx.translate(canvas.width / 2, canvas.height / 2);
                        ctx.rotate(-Math.PI / 6);
                        ctx.fillText('TRAINING MODE', 0, 0);
                        ctx.restore();
                    }
                    
                    const imageUrl = canvas.toDataURL('image/png');
                    document.body.removeChild(snapshotContainer);

                    headerContainer.innerHTML = '';

                    const shareContainer = document.createElement('div');
                    shareContainer.id = 'share-container';
                    
                    const shareText = `I've initiated my future!\n\nVision: ${vision}\nCommit: ${commit}\n\nBoot your own future at ${window.location.href}\n#BootYourFuture`;
                    const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}`;

                    shareContainer.innerHTML = `
                        <p>Your future has been initiated! Share this moment.</p>
                        <div class="share-buttons">
                            <a href="${imageUrl}" download="the-future-sh.png" class="share-button">Download Image</a>
                            <a href="${twitterUrl}" target="_blank" class="share-button">Share on X</a>
                        </div>
                        <img src="${imageUrl}" alt="A snapshot of the initiated future in the-future.sh">
                    `;
                    
                    headerContainer.appendChild(shareContainer);
                    shareContainer.style.display = 'block';
                    window.scrollTo(0, 0);
                });
            }, 100);
        }

        // --- Utility Functions ---
        function scrollToBottom() {
            terminal.scrollTop = terminal.scrollHeight;
        }

        function escapeHtml(unsafe) {
            return unsafe
                 .replace(/&/g, "&amp;")
                 .replace(/</g, "&lt;")
                 .replace(/>/g, "&gt;")
                 .replace(/"/g, "&quot;")
                 .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>
